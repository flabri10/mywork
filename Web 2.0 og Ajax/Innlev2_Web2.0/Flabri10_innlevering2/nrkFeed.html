<!DOCTYPE HTML>
<!--Kodet av Britt-Heidi Fladby-->
<html>
<head>
<meta charset="utf-8">
<title>Nrkfeed</title>
<link rel="stylesheet" type="text/css" href="styleSheet.css" />
<script type="text/javascript" src="jquery-1.8.2.js"></script>
<script type="text/javascript" src="jquery.jfeed.js"></script>

<script type="text/javascript">
<!--

$(function(){
	settEvents();
	fyllKategoriliste();
});

function settEvents(){
	$('#btnHentRss').click(function(){
		hentFeed();
	});	
}

function fyllKategoriliste(){
	$.ajax({
    	type: "GET",
        url: "nrkFeed.xml",
        dataType: "xml",
        success: function(xml){
			var selKategoriliste = $('#selKategoriliste');

			$(xml).find('channel').each(function(){
				var title = $(this).find('category').text();
				var link = $(this).find('link').text();
				selKategoriliste.append("<option value='" + link + "'>" + title + "</option>");
			});
        },
		error: function(){
			$('#divSoek').html("<p>Kunne ikke laste kategoriliste, for den fungerer ikke i Chrome..:(</p>");	
		},
   	});
}

function hentFeed(){
	var htmlTekst = "";
	var soekKategori = "";

	htmlTekst += "<img id='imgLoad' src='loading.gif' alt='Loading picture'>";	
	$('#sectFeed').html(htmlTekst);
	
	htmlTekst = "";
	
	$('#selKategoriliste').change(function(){
		var selectedIndex = $('#selKategoriliste option').index($('#selKategoriliste option:selected'));
		var nyValgt = $(nrkFeed.xml).find('channel').ep(selectedIndex).find('link').each(function(){
			soekKategori = $(this).value();
		});
	});
	
	$.getFeed({
		url: "getRSS.php?url=" + soekKategori,
		success: function(feed){
			var category = feed.category;
			var link = feed.link;
			
			htmlTekst += wrap("NRK - " + category, "h2");

			$.each(channel.items, function(i, item){
				var title = item.title;
				var updated = item.updated;
				var description = item.description;
				
				var norskTid = new Date(updated);
				
				htmlTekst += "<div class='divFeedboks'";
				htmlTekst += wrap(title, "h3");
				htmlTekst += wrap(norskTid.toGMTString(), "p");
				htmlTekst += wrap(description, "p");
				htmlTekst += "</div>";
				
				$.each(channel.items.enclosure, function(i, items){
					var imageUrl =  $(item).find("enclosure").attr('url');
					htmlTekst += "<img class='imgNrkbilde' alt='feedBilde' src=' " + imageUrl + "' />";
				});
				
			});
	
			$('#sectFeed').html(htmlTekst);	
		},
		error: function(){
        	$('#sectFeed').html("<p>Noe gikk galt..</p>");	
		},
		complete: function(){

        }
	});
}

function wrap(tekst, tag){
	return "<" + tag + ">" + tekst + "</" + tag + ">";	
}
-->
</script>
</head>

<body>
<div id="divContainer">
	<header>
    	<h1>NRK RSS Feeds</h1>
        <div id="divSoek">
        	<select id="selKategoriliste">
        		<option value="0" >Velg kategori</option>
            </select>
        	<input id="btnHentRss" value="Hent RSS" type="button"/>
    	</div>
    </header>
    <div id="divFeedcontainer">
    	<section id="sectFeed"></section>
    </div>
</div>
</body>
</html>
